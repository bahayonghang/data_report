# 需求文档

## 介绍

本项目旨在开发一个基于 Web 的自动化数据分析报告工具，专门用于时序数据的探索性分析。用户可以通过 Web 界面上传本地文件或选择服务器文件，系统将自动执行一系列统计分析和可视化，并在网页上展示交互式报告。该工具简化了数据分析流程，无需用户具备深度的数据科学专业知识。

## 需求

### 需求 1 - 文件处理与安全

**用户故事:** 作为数据分析师，我希望能够安全地上传和选择数据文件进行分析，以便快速获得数据洞察。

#### 验收标准

1. WHEN 用户访问 Web 界面 THEN 系统 SHALL 提供文件上传功能支持 CSV 和 Parquet 格式
2. WHEN 用户选择服务器文件 THEN 系统 SHALL 仅显示指定安全目录下的文件列表
3. WHEN 用户尝试访问非法路径 THEN 系统 SHALL 拒绝请求并返回安全错误信息
4. WHEN 文件上传或选择完成 THEN 系统 SHALL 验证文件格式和完整性
5. IF 文件格式不支持 THEN 系统 SHALL 返回明确的错误提示

### 需求 2 - 时序数据识别与处理

**用户故事:** 作为用户，我希望系统能够自动识别时间列并正确处理时序数据，以便获得准确的时间序列分析结果。

#### 验收标准

1. WHEN 系统加载数据文件 THEN 系统 SHALL 自动检测时间列（DateTime、tagTime 或类似模式）
2. WHEN 时间列被识别 THEN 系统 SHALL 将其设置为时间索引且不进行常规统计分析
3. WHEN 处理时间列 THEN 系统 SHALL 计算并返回时间范围（最早和最晚时间点）
4. WHEN 识别数值列 THEN 系统 SHALL 对所有非时间数值列执行完整的统计分析流程

### 需求 3 - 核心统计分析功能

**用户故事:** 作为数据分析师，我希望获得全面的统计分析结果，以便深入了解数据的特征和质量。

#### 验收标准

1. WHEN 分析数值列 THEN 系统 SHALL 计算描述性统计（均值、中位数、标准差、最大/最小值、四分位数）
2. WHEN 处理时间序列数据 THEN 系统 SHALL 执行 ADF 平稳性检验并提供 p 值
3. WHEN 检查数据质量 THEN 系统 SHALL 统计每个变量的缺失值数量与占比
4. WHEN 分析变量关系 THEN 系统 SHALL 计算所有数值型变量间的相关系数矩阵

### 需求 4 - 交互式可视化

**用户故事:** 作为用户，我希望通过交互式图表直观地探索数据，以便更好地理解数据模式和异常。

#### 验收标准

1. WHEN 生成时序图表 THEN 系统 SHALL 使用 Plotly 创建每个变量随时间变化的交互式趋势图
2. WHEN 展示数据分布 THEN 系统 SHALL 为每个变量生成直方图显示分布形态
3. WHEN 检测异常值 THEN 系统 SHALL 为每个变量创建箱形图帮助识别潜在异常
4. WHEN 显示相关性 THEN 系统 SHALL 生成相关系数热力图在报告起始部分展示
5. WHEN 返回图表 THEN 系统 SHALL 以 JSON 格式返回 Plotly 图表而非 HTML

### 需求 5 - Web 界面与用户体验

**用户故事:** 作为用户，我希望拥有直观易用的 Web 界面，能够快速完成分析并查看结果。

#### 验收标准

1. WHEN 用户访问应用 THEN 系统 SHALL 提供单页面应用界面包含文件上传和服务器文件选择功能
2. WHEN 分析进行中 THEN 系统 SHALL 显示实时进度指示器和状态反馈
3. WHEN 分析完成 THEN 系统 SHALL 在当前页面动态展示所有分析结果和交互式图表
4. WHEN 发生错误 THEN 系统 SHALL 提供清晰的错误信息和恢复建议
5. WHEN 用户操作界面 THEN 系统 SHALL 确保响应式设计支持桌面和平板设备

### 需求 6 - API 设计与性能

**用户故事:** 作为开发者，我希望系统提供清晰的 API 接口和良好的性能，以便维护和扩展功能。

#### 验收标准

1. WHEN 设计 API THEN 系统 SHALL 提供 RESTful 接口包括文件列表、服务器文件分析、文件上传分析
2. WHEN 处理大数据集 THEN 系统 SHALL 使用 Polars 确保高性能数据处理
3. WHEN 返回分析结果 THEN 系统 SHALL 使用标准 HTTP 状态码和结构化 JSON 响应
4. WHEN 发生异常 THEN 系统 SHALL 提供详细错误信息但不暴露系统内部细节
5. WHEN 启动服务 THEN 系统 SHALL 通过 uvicorn 提供高性能 ASGI 服务